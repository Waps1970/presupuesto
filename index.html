<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presupuesto Catorcenal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #ff6b6b, #ffa726);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="2" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .period-selector {
            background: #f8f9fa;
            padding: 20px 30px;
            border-bottom: 2px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .period-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .period-badge {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .period-controls {
            display: flex;
            gap: 10px;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
        }

        .btn-danger:hover {
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .content {
            padding: 30px;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            border: 2px solid transparent;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card.income {
            border-color: #4caf50;
            background: linear-gradient(135deg, #e8f5e8 0%, #f1f8e9 100%);
        }

        .card.expense {
            border-color: #f44336;
            background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%);
        }

        .card.balance {
            border-color: #2196f3;
            background: linear-gradient(135deg, #e3f2fd 0%, #e1f5fe 100%);
        }

        .card h3 {
            color: #333;
            font-size: 1rem;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .card .amount {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
        }

        .sections {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section h2::before {
            content: '';
            width: 4px;
            height: 25px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 2px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-row {
            display: flex;
            gap: 10px;
            align-items: end;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        input[type="number"],
        input[type="text"],
        input[type="date"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        input[type="number"]:focus,
        input[type="text"]:focus,
        input[type="date"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .items-list {
            margin-top: 20px;
        }

        .item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .item:hover {
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .item-info {
            flex: 1;
        }

        .item-description {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .item-details {
            font-size: 0.9rem;
            color: #666;
        }

        .item-amount {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
        }

        .delete-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            margin-left: 10px;
        }

        .delete-btn:hover {
            background: #ff5252;
            transform: scale(1.1);
        }

        .empty-state {
            text-align: center;
            color: #999;
            font-style: italic;
            padding: 20px;
        }

        @media (max-width: 768px) {
            .sections {
                grid-template-columns: 1fr;
            }
            
            .period-selector {
                flex-direction: column;
                text-align: center;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }

        .projected-expense {
            opacity: 0.7;
            border-left: 4px solid #ffa726;
        }

        .projection-indicator {
            background: #ffa726;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            margin-left: 10px;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .modal-header h2 {
            color: #333;
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .modal-body {
            margin-bottom: 25px;
        }

        .date-range {
            display: flex;
            gap: 15px;
            align-items: end;
            margin-bottom: 20px;
        }

        .date-range > div {
            flex: 1;
        }

        .period-quick-select {
            margin-bottom: 20px;
        }

        .quick-select-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .quick-btn {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            color: #333;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .quick-btn:hover,
        .quick-btn.active {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }

        .modal-footer {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 20px;
            top: 15px;
        }

        .close:hover {
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ Presupuesto Catorcenal</h1>
            <p>Administra tu dinero cada 14 d√≠as de manera inteligente</p>
        </div>

        <div class="period-selector">
            <div class="period-info">
                <span class="period-badge" id="currentPeriod">Per√≠odo 1</span>
                <span id="periodDates">6 Jun 2025 - 19 Jun 2025</span>
            </div>
            <div class="period-controls">
                <button class="btn" onclick="previousPeriod()">‚Üê Anterior</button>
                <button class="btn" onclick="nextPeriod()">Siguiente ‚Üí</button>
                <button class="btn" onclick="showPdfModal()" style="background: linear-gradient(45deg, #4caf50, #45a049);">üìÑ Generar PDF</button>
                <button class="btn btn-danger" onclick="resetData()">Reiniciar Todo</button>
            </div>
        </div>

        <div class="content">
            <div class="summary-cards">
                <div class="card income">
                    <h3>Total Ingresos</h3>
                    <div class="amount" id="totalIncome">$0</div>
                </div>
                <div class="card expense">
                    <h3>Total Gastos</h3>
                    <div class="amount" id="totalExpenses">$0</div>
                </div>
                <div class="card balance">
                    <h3>Saldo Disponible</h3>
                    <div class="amount" id="availableBalance">$0</div>
                </div>
            </div>

            <div class="sections">
                <div class="section">
                    <h2>üíµ Ingresos</h2>
                    
                    <div class="form-group">
                        <label>Ingreso Principal:</label>
                        <input type="number" id="mainIncome" placeholder="Cantidad que recibes" step="0.01">
                        <button class="btn" onclick="setMainIncome()" style="margin-top: 10px; width: 100%;">Establecer Ingreso</button>
                    </div>

                    <div class="form-group">
                        <label>Ingresos Adicionales:</label>
                        <div class="form-row">
                            <input type="text" id="incomeDesc" placeholder="Descripci√≥n del ingreso" style="flex: 2;">
                            <input type="number" id="incomeAmount" placeholder="Cantidad" step="0.01" style="flex: 1;">
                            <button class="btn" onclick="addIncome()">Agregar</button>
                        </div>
                    </div>

                    <div class="items-list" id="incomeList">
                        <div class="empty-state">No hay ingresos adicionales registrados</div>
                    </div>
                </div>

                <div class="section">
                    <h2>üí∏ Gastos</h2>
                    
                    <div class="form-row">
                        <div style="flex: 2;">
                            <label>Descripci√≥n:</label>
                            <input type="text" id="expenseDesc" placeholder="¬øEn qu√© gastaste?">
                        </div>
                        <div style="flex: 1;">
                            <label>Cantidad:</label>
                            <input type="number" id="expenseAmount" placeholder="Cantidad" step="0.01">
                        </div>
                        <div style="flex: 1;">
                            <label>Fecha:</label>
                            <input type="date" id="expenseDate">
                        </div>
                        <div style="padding-top: 27px;">
                            <button class="btn" onclick="addExpense()">Agregar</button>
                        </div>
                    </div>

                    <div class="items-list" id="expenseList">
                        <div class="empty-state">No hay gastos registrados</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para generar PDF -->
    <div id="pdfModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePdfModal()">&times;</span>
            <div class="modal-header">
                <h2>üìÑ Generar Reporte PDF</h2>
                <p>Selecciona el per√≠odo que deseas incluir en el reporte</p>
            </div>
            <div class="modal-body">
                <div class="period-quick-select">
                    <label><strong>Selecci√≥n r√°pida:</strong></label>
                    <div class="quick-select-buttons">
                        <button class="quick-btn" onclick="selectCurrentPeriod()">Per√≠odo Actual</button>
                        <button class="quick-btn" onclick="selectAllPeriods()">Todos los Per√≠odos</button>
                        <button class="quick-btn" onclick="selectLastThree()">√öltimos 3 Per√≠odos</button>
                    </div>
                </div>
                
                <div class="date-range">
                    <div>
                        <label>Fecha Inicio:</label>
                        <input type="date" id="pdfStartDate">
                    </div>
                    <div>
                        <label>Fecha Fin:</label>
                        <input type="date" id="pdfEndDate">
                    </div>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="includeProjections" checked>
                        Incluir gastos proyectados (futuros)
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="generatePDF()">Generar PDF</button>
                <button class="btn" onclick="closePdfModal()" style="background: #6c757d;">Cancelar</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        let currentPeriodIndex = 0;
        let periods = [];
        let startDate = new Date('2025-06-06');

        // Inicializar per√≠odos
        function initializePeriods() {
            for (let i = 0; i < 12; i++) {
                let periodStart = new Date(startDate);
                periodStart.setDate(startDate.getDate() + (i * 14));
                let periodEnd = new Date(periodStart);
                periodEnd.setDate(periodStart.getDate() + 13);
                
                periods.push({
                    start: periodStart,
                    end: periodEnd,
                    mainIncome: 0,
                    additionalIncomes: [],
                    expenses: [],
                    transferredBalance: i === 0 ? 0 : 0
                });
            }
            loadData();
            updateDisplay();
        }

        // Formatear fecha
        function formatDate(date) {
            return date.toLocaleDateString('es-ES', { 
                day: 'numeric', 
                month: 'short', 
                year: 'numeric' 
            });
        }

        // Actualizar display
        function updateDisplay() {
            const period = periods[currentPeriodIndex];
            
            // Actualizar informaci√≥n del per√≠odo
            document.getElementById('currentPeriod').textContent = `Per√≠odo ${currentPeriodIndex + 1}`;
            document.getElementById('periodDates').textContent = 
                `${formatDate(period.start)} - ${formatDate(period.end)}`;

            // Calcular totales
            const totalMainIncome = period.mainIncome + period.transferredBalance;
            const totalAdditionalIncome = period.additionalIncomes.reduce((sum, income) => sum + income.amount, 0);
            const totalIncome = totalMainIncome + totalAdditionalIncome;
            
            const currentDate = new Date();
            const realizedExpenses = period.expenses
                .filter(expense => new Date(expense.date) <= currentDate)
                .reduce((sum, expense) => sum + expense.amount, 0);
            
            const projectedExpenses = period.expenses
                .filter(expense => new Date(expense.date) > currentDate)
                .reduce((sum, expense) => sum + expense.amount, 0);
            
            const totalExpenses = realizedExpenses + projectedExpenses;
            const availableBalance = totalIncome - realizedExpenses;

            // Actualizar cards
            document.getElementById('totalIncome').textContent = `$${totalIncome.toFixed(2)}`;
            document.getElementById('totalExpenses').textContent = `$${totalExpenses.toFixed(2)}`;
            document.getElementById('availableBalance').textContent = `$${availableBalance.toFixed(2)}`;

            // Actualizar ingreso principal
            document.getElementById('mainIncome').value = period.mainIncome;

            // Actualizar listas
            updateIncomeList();
            updateExpenseList();
            
            saveData();
        }

        // Establecer ingreso principal
        function setMainIncome() {
            const amount = parseFloat(document.getElementById('mainIncome').value) || 0;
            periods[currentPeriodIndex].mainIncome = amount;
            updateDisplay();
        }

        // Agregar ingreso adicional
        function addIncome() {
            const desc = document.getElementById('incomeDesc').value.trim();
            const amount = parseFloat(document.getElementById('incomeAmount').value) || 0;
            
            if (!desc || amount <= 0) {
                alert('Por favor ingresa una descripci√≥n v√°lida y una cantidad mayor a 0');
                return;
            }
            
            periods[currentPeriodIndex].additionalIncomes.push({
                id: Date.now(),
                description: desc,
                amount: amount
            });
            
            document.getElementById('incomeDesc').value = '';
            document.getElementById('incomeAmount').value = '';
            updateDisplay();
        }

        // Agregar gasto
        function addExpense() {
            const desc = document.getElementById('expenseDesc').value.trim();
            const amount = parseFloat(document.getElementById('expenseAmount').value) || 0;
            const date = document.getElementById('expenseDate').value || new Date().toISOString().split('T')[0];
            
            if (!desc || amount <= 0) {
                alert('Por favor ingresa una descripci√≥n v√°lida y una cantidad mayor a 0');
                return;
            }
            
            periods[currentPeriodIndex].expenses.push({
                id: Date.now(),
                description: desc,
                amount: amount,
                date: date
            });
            
            document.getElementById('expenseDesc').value = '';
            document.getElementById('expenseAmount').value = '';
            document.getElementById('expenseDate').value = '';
            updateDisplay();
        }

        // Actualizar lista de ingresos
        function updateIncomeList() {
            const period = periods[currentPeriodIndex];
            const container = document.getElementById('incomeList');
            
            if (period.additionalIncomes.length === 0) {
                container.innerHTML = '<div class="empty-state">No hay ingresos adicionales registrados</div>';
                return;
            }
            
            container.innerHTML = period.additionalIncomes.map(income => `
                <div class="item">
                    <div class="item-info">
                        <div class="item-description">${income.description}</div>
                    </div>
                    <div class="item-amount">$${income.amount.toFixed(2)}</div>
                    <button class="delete-btn" onclick="deleteIncome(${income.id})">√ó</button>
                </div>
            `).join('');
        }

        // Actualizar lista de gastos
        function updateExpenseList() {
            const period = periods[currentPeriodIndex];
            const container = document.getElementById('expenseList');
            
            if (period.expenses.length === 0) {
                container.innerHTML = '<div class="empty-state">No hay gastos registrados</div>';
                return;
            }
            
            const currentDate = new Date();
            
            container.innerHTML = period.expenses
                .sort((a, b) => new Date(a.date) - new Date(b.date))
                .map(expense => {
                    const expenseDate = new Date(expense.date);
                    const isProjected = expenseDate > currentDate;
                    
                    return `
                        <div class="item ${isProjected ? 'projected-expense' : ''}">
                            <div class="item-info">
                                <div class="item-description">
                                    ${expense.description}
                                    ${isProjected ? '<span class="projection-indicator">Proyectado</span>' : ''}
                                </div>
                                <div class="item-details">
                                    Fecha: ${formatDate(expenseDate)}
                                </div>
                            </div>
                            <div class="item-amount">$${expense.amount.toFixed(2)}</div>
                            <button class="delete-btn" onclick="deleteExpense(${expense.id})">√ó</button>
                        </div>
                    `;
                }).join('');
        }

        // Eliminar ingreso
        function deleteIncome(id) {
            const period = periods[currentPeriodIndex];
            period.additionalIncomes = period.additionalIncomes.filter(income => income.id !== id);
            updateDisplay();
        }

        // Eliminar gasto
        function deleteExpense(id) {
            const period = periods[currentPeriodIndex];
            period.expenses = period.expenses.filter(expense => expense.id !== id);
            updateDisplay();
        }

        // Per√≠odo anterior
        function previousPeriod() {
            if (currentPeriodIndex > 0) {
                currentPeriodIndex--;
                updateDisplay();
            }
        }

        // Per√≠odo siguiente
        function nextPeriod() {
            if (currentPeriodIndex < periods.length - 1) {
                // Transferir saldo al siguiente per√≠odo
                transferBalanceToNext();
                currentPeriodIndex++;
                updateDisplay();
            }
        }

        // Transferir saldo al siguiente per√≠odo
        function transferBalanceToNext() {
            if (currentPeriodIndex < periods.length - 1) {
                const currentPeriod = periods[currentPeriodIndex];
                const nextPeriod = periods[currentPeriodIndex + 1];
                
                const totalIncome = currentPeriod.mainIncome + currentPeriod.transferredBalance +
                    currentPeriod.additionalIncomes.reduce((sum, income) => sum + income.amount, 0);
                
                const currentDate = new Date();
                const realizedExpenses = currentPeriod.expenses
                    .filter(expense => new Date(expense.date) <= currentDate)
                    .reduce((sum, expense) => sum + expense.amount, 0);
                
                const availableBalance = totalIncome - realizedExpenses;
                nextPeriod.transferredBalance = Math.max(0, availableBalance);
            }
        }

        // Reiniciar datos
        function resetData() {
            if (confirm('¬øEst√°s segura de que quieres reiniciar todos los datos? Esta acci√≥n no se puede deshacer.')) {
                localStorage.removeItem('budgetData');
                periods = [];
                currentPeriodIndex = 0;
                initializePeriods();
            }
        }

        // Guardar datos
        function saveData() {
            const data = {
                currentPeriodIndex,
                periods: periods.map(period => ({
                    ...period,
                    start: period.start.toISOString(),
                    end: period.end.toISOString()
                }))
            };
            localStorage.setItem('budgetData', JSON.stringify(data));
        }

        // Cargar datos
        function loadData() {
            const saved = localStorage.getItem('budgetData');
            if (saved) {
                const data = JSON.parse(saved);
                currentPeriodIndex = data.currentPeriodIndex || 0;
                if (data.periods && data.periods.length > 0) {
                    periods = data.periods.map(period => ({
                        ...period,
                        start: new Date(period.start),
                        end: new Date(period.end)
                    }));
                }
            }
        }

        // Establecer fecha actual por defecto
        document.getElementById('expenseDate').value = new Date().toISOString().split('T')[0];

        // Funciones para el modal PDF
        function showPdfModal() {
            document.getElementById('pdfModal').style.display = 'block';
            // Establecer fechas por defecto del per√≠odo actual
            const period = periods[currentPeriodIndex];
            document.getElementById('pdfStartDate').value = period.start.toISOString().split('T')[0];
            document.getElementById('pdfEndDate').value = period.end.toISOString().split('T')[0];
        }

        function closePdfModal() {
            document.getElementById('pdfModal').style.display = 'none';
        }

        function selectCurrentPeriod() {
            const period = periods[currentPeriodIndex];
            document.getElementById('pdfStartDate').value = period.start.toISOString().split('T')[0];
            document.getElementById('pdfEndDate').value = period.end.toISOString().split('T')[0];
            updateQuickSelectButtons('current');
        }

        function selectAllPeriods() {
            document.getElementById('pdfStartDate').value = periods[0].start.toISOString().split('T')[0];
            document.getElementById('pdfEndDate').value = periods[periods.length - 1].end.toISOString().split('T')[0];
            updateQuickSelectButtons('all');
        }

        function selectLastThree() {
            const startIndex = Math.max(0, currentPeriodIndex - 2);
            document.getElementById('pdfStartDate').value = periods[startIndex].start.toISOString().split('T')[0];
            document.getElementById('pdfEndDate').value = periods[currentPeriodIndex].end.toISOString().split('T')[0];
            updateQuickSelectButtons('lastthree');
        }

        function updateQuickSelectButtons(active) {
            document.querySelectorAll('.quick-btn').forEach(btn => btn.classList.remove('active'));
            if (active === 'current') document.querySelector('.quick-btn:nth-child(1)').classList.add('active');
            if (active === 'all') document.querySelector('.quick-btn:nth-child(2)').classList.add('active');
            if (active === 'lastthree') document.querySelector('.quick-btn:nth-child(3)').classList.add('active');
        }

        function generatePDF() {
            const startDate = new Date(document.getElementById('pdfStartDate').value);
            const endDate = new Date(document.getElementById('pdfEndDate').value);
            const includeProjections = document.getElementById('includeProjections').checked;
            
            if (!startDate || !endDate || startDate > endDate) {
                alert('Por favor selecciona un rango de fechas v√°lido');
                return;
            }

            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Configuraci√≥n
                const pageWidth = doc.internal.pageSize.getWidth();
                const margin = 20;
                let yPosition = margin;
                
                // T√≠tulo
                doc.setFontSize(20);
                doc.setFont(undefined, 'bold');
                doc.text('REPORTE DE PRESUPUESTO CATORCENAL', pageWidth / 2, yPosition, { align: 'center' });
                yPosition += 15;
                
                // Per√≠odo
                doc.setFontSize(12);
                doc.setFont(undefined, 'normal');
                doc.text(`Per√≠odo: ${formatDate(startDate)} - ${formatDate(endDate)}`, pageWidth / 2, yPosition, { align: 'center' });
                yPosition += 10;
                doc.text(`Generado: ${formatDate(new Date())}`, pageWidth / 2, yPosition, { align: 'center' });
                yPosition += 20;
                
                // Filtrar per√≠odos en el rango
                const relevantPeriods = periods.filter(period => 
                    (period.start <= endDate && period.end >= startDate)
                );
                
                let totalIncome = 0;
                let totalExpenses = 0;
                let totalProjected = 0;
                
                // Procesar cada per√≠odo
                relevantPeriods.forEach((period, index) => {
                    // T√≠tulo del per√≠odo
                    if (yPosition > 250) {
                        doc.addPage();
                        yPosition = margin;
                    }
                    
                    doc.setFontSize(14);
                    doc.setFont(undefined, 'bold');
                    doc.text(`PER√çODO ${periods.indexOf(period) + 1}: ${formatDate(period.start)} - ${formatDate(period.end)}`, margin, yPosition);
                    yPosition += 10;
                    
                    // Ingresos
                    doc.setFontSize(12);
                    doc.setFont(undefined, 'bold');
                    doc.text('INGRESOS:', margin, yPosition);
                    yPosition += 7;
                    
                    doc.setFont(undefined, 'normal');
                    if (period.transferredBalance > 0) {
                        doc.text(`‚Ä¢ Saldo transferido: ${period.transferredBalance.toFixed(2)}`, margin + 5, yPosition);
                        yPosition += 6;
                        totalIncome += period.transferredBalance;
                    }
                    
                    if (period.mainIncome > 0) {
                        doc.text(`‚Ä¢ Ingreso principal: ${period.mainIncome.toFixed(2)}`, margin + 5, yPosition);
                        yPosition += 6;
                        totalIncome += period.mainIncome;
                    }
                    
                    period.additionalIncomes.forEach(income => {
                        doc.text(`‚Ä¢ ${income.description}: ${income.amount.toFixed(2)}`, margin + 5, yPosition);
                        yPosition += 6;
                        totalIncome += income.amount;
                    });
                    
                    yPosition += 5;
                    
                    // Gastos
                    doc.setFont(undefined, 'bold');
                    doc.text('GASTOS:', margin, yPosition);
                    yPosition += 7;
                    
                    doc.setFont(undefined, 'normal');
                    const currentDate = new Date();
                    
                    // Gastos realizados
                    const realizedExpenses = period.expenses.filter(expense => {
                        const expenseDate = new Date(expense.date);
                        return expenseDate <= currentDate && expenseDate >= startDate && expenseDate <= endDate;
                    });
                    
                    const projectedExpenses = period.expenses.filter(expense => {
                        const expenseDate = new Date(expense.date);
                        return expenseDate > currentDate && expenseDate >= startDate && expenseDate <= endDate;
                    });
                    
                    realizedExpenses.forEach(expense => {
                        if (yPosition > 280) {
                            doc.addPage();
                            yPosition = margin;
                        }
                        doc.text(`‚Ä¢ ${expense.description} (${formatDate(new Date(expense.date))}): ${expense.amount.toFixed(2)}`, margin + 5, yPosition);
                        yPosition += 6;
                        totalExpenses += expense.amount;
                    });
                    
                    // Gastos proyectados
                    if (includeProjections && projectedExpenses.length > 0) {
                        yPosition += 3;
                        doc.setFont(undefined, 'bold');
                        doc.text('GASTOS PROYECTADOS:', margin + 5, yPosition);
                        yPosition += 6;
                        
                        doc.setFont(undefined, 'normal');
                        projectedExpenses.forEach(expense => {
                            if (yPosition > 280) {
                                doc.addPage();
                                yPosition = margin;
                            }
                            doc.text(`‚Ä¢ ${expense.description} (${formatDate(new Date(expense.date))}): ${expense.amount.toFixed(2)}`, margin + 10, yPosition);
                            yPosition += 6;
                            totalProjected += expense.amount;
                        });
                    }
                    
                    yPosition += 10;
                });
                
                // Resumen final
                if (yPosition > 240) {
                    doc.addPage();
                    yPosition = margin;
                }
                
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text('RESUMEN GENERAL', margin, yPosition);
                yPosition += 10;
                
                doc.setFontSize(12);
                doc.text(`Total Ingresos: ${totalIncome.toFixed(2)}`, margin, yPosition);
                yPosition += 8;
                doc.text(`Total Gastos Realizados: ${totalExpenses.toFixed(2)}`, margin, yPosition);
                yPosition += 8;
                
                if (includeProjections && totalProjected > 0) {
                    doc.text(`Total Gastos Proyectados: ${totalProjected.toFixed(2)}`, margin, yPosition);
                    yPosition += 8;
                    doc.text(`Total Gastos (Real + Proyectado): ${(totalExpenses + totalProjected).toFixed(2)}`, margin, yPosition);
                    yPosition += 8;
                }
                
                const balance = totalIncome - totalExpenses;
                const projectedBalance = totalIncome - totalExpenses - totalProjected;
                
                doc.setFont(undefined, 'bold');
                doc.text(`Saldo Disponible Actual: ${balance.toFixed(2)}`, margin, yPosition);
                
                if (includeProjections && totalProjected > 0) {
                    yPosition += 8;
                    doc.text(`Saldo Proyectado: ${projectedBalance.toFixed(2)}`, margin, yPosition);
                }
                
                // Descargar PDF
                const fileName = `presupuesto_${formatDate(startDate).replace(/\s+/g, '_')}_${formatDate(endDate).replace(/\s+/g, '_')}.pdf`;
                doc.save(fileName);
                
                closePdfModal();
                
            } catch (error) {
                console.error('Error generando PDF:', error);
                alert('Error al generar el PDF. Por favor intenta nuevamente.');
            }
        }

        // Cerrar modal al hacer click fuera
        window.onclick = function(event) {
            const modal = document.getElementById('pdfModal');
            if (event.target === modal) {
                closePdfModal();
            }
        }

        // Inicializar aplicaci√≥n
        initializePeriods();
    </script>
</body>
</html>
